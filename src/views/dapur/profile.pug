//- src/views/dapur/profile.pug
extends ../layout

block content
  .container-fluid.px-3.px-lg-5.py-4.py-lg-5
    //- Header dengan desain serupa dashboard
    .dashboard-header.mb-5
      .d-flex.justify-content-between.align-items-center.flex-wrap.gap-3
        div
          .d-flex.align-items-center.gap-3.mb-2
            i.bi.bi-person-circle.header-icon
            div
              h1.mb-1.fw-bold.text-dark Profil Dapur
              p.text-muted.mb-0.d-flex.align-items-center.gap-2
                i.bi.bi-shield-check(style="font-size: 0.9rem;")
                span Kelola informasi akun dan data dapur Anda
        
        a.btn.btn-outline-secondary.px-4.py-2.shadow-sm(href="/dapur/dashboard")
          i.bi.bi-arrow-left.me-2
          span Kembali ke Dashboard

    .row.g-4
      //- PROFIL UTAMA
      .col-lg-8
        .card.border-0.shadow-sm.profile-card.mb-4
          .card-body.p-4
            .d-flex.align-items-start.gap-4.mb-4.pb-4.border-bottom
              .avatar-wrapper
                .avatar-circle.bg-light.text-success
                  i.bi.bi-person-circle
              div.flex-grow-1
                .d-flex.justify-content-between.align-items-start.flex-wrap.gap-2.mb-2
                  h3.mb-0.fw-bold.text-dark= user.name
                  span.badge.bg-success.bg-opacity-10.text-success.px-3.py-2.fw-semibold
                    i.bi.bi-shield-check.me-1
                    = user.role
                p.text-muted.mb-0
                  i.bi.bi-envelope.me-1
                  = user.email || 'Email belum diatur'
              
                //- Quick Stats
                .row.g-3.mt-4
                  .col-6.col-md-4
                    .stat-mini.p-3.bg-light.rounded-3
                      .d-flex.align-items-center.gap-2.mb-2
                        i.bi.bi-clock-history.text-warning
                        span.text-muted.small Menunggu
                      h5.mb-0.fw-bold= pendingOrders || 0
                  
                  .col-6.col-md-4
                    .stat-mini.p-3.bg-light.rounded-3
                      .d-flex.align-items-center.gap-2.mb-2
                        i.bi.bi-check-circle.text-success
                        span.text-muted.small Disetujui
                      h5.mb-0.fw-bold= approvedOrders || 0
                  
                  .col-6.col-md-4
                    .stat-mini.p-3.bg-light.rounded-3
                      .d-flex.align-items-center.gap-2.mb-2
                        i.bi.bi-clipboard-check.text-primary
                        span.text-muted.small Selesai
                      h5.mb-0.fw-bold= completedOrders || 0

            //- Detail Informasi
            .row.g-4
              .col-md-6
                .info-card.p-4.border.rounded-3.h-100
                  h5.mb-4.fw-semibold.text-dark
                    i.bi.bi-info-circle.me-2.text-primary
                    | Informasi Kontak
                  
                  .info-item.mb-3.p-3.bg-light.rounded-3
                    .d-flex.align-items-start.gap-3
                      i.bi.bi-envelope.fs-5.text-primary
                      div
                        small.text-muted.d-block.mb-1 Email
                        .fw-medium.text-dark= user.email || 'Belum diatur'
                  
                  .info-item.mb-3.p-3.bg-light.rounded-3
                    .d-flex.align-items-start.gap-3
                      i.bi.bi-telephone.fs-5.text-success
                      div
                        small.text-muted.d-block.mb-1 Telepon
                        .fw-medium.text-dark= user.phone || 'Belum diatur'
                  
                  .info-item.mb-0.p-3.bg-light.rounded-3
                    .d-flex.align-items-start.gap-3
                      i.bi.bi-geo-alt.fs-5.text-warning
                      div
                        small.text-muted.d-block.mb-1 Alamat
                        .fw-medium.text-dark= user.address || 'Belum diatur'

              .col-md-6
                .info-card.p-4.border.rounded-3.h-100
                  h5.mb-4.fw-semibold.text-dark
                    i.bi.bi-calendar-check.me-2.text-success
                    | Aktivitas Terakhir
                  
                  if recentActivity && recentActivity.length
                    .activity-list
                      each activity in recentActivity
                        .activity-item.mb-3.p-3.bg-light.rounded-3
                          .d-flex.justify-content-between.align-items-start.mb-2
                            span.fw-semibold.text-dark= activity.title
                            small.text-muted= activity.time
                          p.mb-0.small.text-muted= activity.description
                  else
                    .empty-state.text-center.py-4
                      i.bi.bi-activity.text-muted.mb-3(style="font-size: 2rem;")
                      p.text-muted.mb-0 Belum ada aktivitas terbaru

        //- Quick Actions
        .card.border-0.shadow-sm.quick-actions-card
          .card-body.p-4
            h5.card-title.mb-4.fw-semibold.text-dark
              i.bi.bi-lightning-charge-fill.me-2.text-warning
              | Aksi Cepat
            
            .row.g-3
              .col-md-6
                a.action-btn.p-3.rounded-3.d-block(href="/dapur/profile/complete")
                  .d-flex.align-items-center.gap-3
                    .action-icon.bg-primary.bg-opacity-10
                      i.bi.bi-pencil-square.text-primary
                    div
                      .fw-semibold.text-dark Lengkapi Data
                      small.text-muted.d-block Update profil Anda
              
              .col-md-6
                a.action-btn.p-3.rounded-3.d-block(href="/dapur/profile/password")
                  .d-flex.align-items-center.gap-3
                    .action-icon.bg-warning.bg-opacity-10
                      i.bi.bi-key.text-warning
                    div
                      .fw-semibold.text-dark Ganti Password
                      small.text-muted.d-block Update keamanan akun
              
              .col-md-6
                a.action-btn.p-3.rounded-3.d-block(href="/dapur/orders")
                  .d-flex.align-items-center.gap-3
                    .action-icon.bg-info.bg-opacity-10
                      i.bi.bi-list-check.text-info
                    div
                      .fw-semibold.text-dark Riwayat Pesanan
                      small.text-muted.d-block Lihat semua pesanan
              
              .col-md-6
                a.action-btn.p-3.rounded-3.d-block(href="/market")
                  .d-flex.align-items-center.gap-3
                    .action-icon.bg-success.bg-opacity-10
                      i.bi.bi-bag-check.text-success
                    div
                      .fw-semibold.text-dark Belanja
                      small.text-muted.d-block Buka marketplace

      //- SIDEBAR - INFORMASI AKUN
      .col-lg-4
        //- Status Akun
        .card.border-0.shadow-sm.account-status-card.mb-4
          .card-body.p-4
            h5.card-title.mb-4.fw-semibold.text-dark
              i.bi.bi-shield-check.me-2.text-success
              | Status Akun
            
            .status-item.mb-4
              .d-flex.align-items-center.justify-content-between.mb-2
                span.fw-medium.text-dark Verifikasi Email
                if user.email_verified
                  span.badge.bg-success.bg-opacity-10.text-success
                    i.bi.bi-check-circle.me-1
                    | Terverifikasi
                else
                  span.badge.bg-warning.bg-opacity-10.text-warning
                    i.bi.bi-exclamation-circle.me-1
                    | Belum
              .progress(style="height: 6px; background: #f1f5f9;")
                .progress-bar(class=user.email_verified ? 'bg-success' : 'bg-warning', style="width: " + (user.email_verified ? '100' : '40') + "%;")
            
            .status-item.mb-4
              .d-flex.align-items-center.justify-content-between.mb-2
                span.fw-medium.text-dark Kelengkapan Data
                span.badge.bg-info.bg-opacity-10.text-info= profileCompletion + '%'
              .progress(style="height: 6px; background: #f1f5f9;")
                .progress-bar.bg-info(style="width: " + profileCompletion + "%;")
            
            .status-item.mb-4
              .d-flex.align-items-center.justify-content-between.mb-2
                span.fw-medium.text-dark Anggota Sejak
                small.text-muted= memberSince
              .progress(style="height: 6px; background: #f1f5f9;")
                .progress-bar.bg-primary(style="width: 100%;")

        //- Informasi Penting
        .card.border-0.shadow-sm.important-info-card
          .card-body.p-4
            h5.card-title.mb-4.fw-semibold.text-dark
              i.bi.bi-info-circle-fill.me-2.text-primary
              | Informasi Penting
            
            .info-tips
              .tip-item.mb-3.p-3.bg-light.rounded-3
                .d-flex.align-items-start.gap-3
                  i.bi.bi-check-circle.text-success
                  div
                    h6.fw-semibold.mb-1.text-dark Lengkapi Profil
                    p.small.mb-0 Pastikan data profil lengkap untuk kemudahan transaksi
              
              .tip-item.mb-3.p-3.bg-light.rounded-3
                .d-flex.align-items-start.gap-3
                  i.bi.bi-bell.text-warning
                  div
                    h6.fw-semibold.mb-1.text-dark Notifikasi
                    p.small.mb-0 Aktifkan notifikasi untuk update pesanan terkini
              
              .tip-item.mb-0.p-3.bg-light.rounded-3
                .d-flex.align-items-start.gap-3
                  i.bi.bi-shield-lock.text-danger
                  div
                    h6.fw-semibold.mb-1.text-dark Keamanan
                    p.small.mb-0 Jaga kerahasiaan password dan lakukan update berkala

  //- Custom Styles
  style.
    :root {
      --primary-green: #10b981;
      --dark-green: #059669;
      --light-green: #d1fae5;
      --success: #10b981;
      --warning: #f59e0b;
      --info: #3b82f6;
      --danger: #ef4444;
    }
    
    /* Header */
    .header-icon {
      font-size: 2rem;
      color: var(--primary-green);
      animation: fadeInScale 0.6s ease-out;
    }
    
    @keyframes fadeInScale {
      from {
        opacity: 0;
        transform: scale(0.8);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }
    
    .dashboard-header h1 {
      font-size: 2rem;
      animation: fadeInUp 0.6s ease-out;
    }
    
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    /* Profile Card */
    .profile-card,
    .account-status-card,
    .important-info-card,
    .quick-actions-card {
      border-radius: 16px;
      transition: all 0.4s ease;
      opacity: 0;
      transform: translateY(30px);
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
    }
    
    .profile-card.visible,
    .account-status-card.visible,
    .important-info-card.visible,
    .quick-actions-card.visible {
      opacity: 1;
      transform: translateY(0);
    }
    
    .avatar-wrapper {
      flex-shrink: 0;
    }
    
    .avatar-circle {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3.5rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      transition: all 0.3s ease;
      border: 3px solid white;
    }
    
    .profile-card:hover .avatar-circle {
      transform: scale(1.05);
      box-shadow: 0 8px 16px rgba(16, 185, 129, 0.2);
    }
    
    /* Stat Mini */
    .stat-mini {
      transition: all 0.3s ease;
      border: 1px solid transparent;
    }
    
    .stat-mini:hover {
      background: white !important;
      border-color: #e5e7eb;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
    }
    
    /* Info Card */
    .info-card {
      background: white;
      border: 1px solid #e5e7eb;
      transition: all 0.3s ease;
    }
    
    .info-card:hover {
      border-color: var(--primary-green);
      box-shadow: 0 8px 16px rgba(16, 185, 129, 0.1);
    }
    
    .info-item {
      transition: all 0.3s ease;
      border: 1px solid transparent;
    }
    
    .info-item:hover {
      background: white !important;
      border-color: #e5e7eb;
      transform: translateX(4px);
    }
    
    /* Activity Items */
    .activity-item {
      transition: all 0.3s ease;
      border: 1px solid transparent;
    }
    
    .activity-item:hover {
      background: white !important;
      border-color: var(--primary-green);
      transform: translateX(4px);
    }
    
    /* Status Items */
    .status-item {
      transition: all 0.3s ease;
    }
    
    .status-item:hover .progress-bar {
      transform: scaleY(1.2);
    }
    
    /* Tip Items */
    .tip-item {
      transition: all 0.3s ease;
      border: 1px solid transparent;
    }
    
    .tip-item:hover {
      background: white !important;
      border-color: var(--primary-green);
      transform: translateX(4px);
    }
    
    /* Quick Actions */
    .action-btn {
      background: #fafafa;
      border: 2px solid #e5e7eb;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      text-decoration: none;
      display: block;
      height: 100%;
    }
    
    .action-btn:hover {
      background: white;
      border-color: var(--primary-green);
      transform: translateX(8px);
      box-shadow: 0 8px 16px rgba(16, 185, 129, 0.15);
    }
    
    .action-icon {
      width: 48px;
      height: 48px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.3rem;
      transition: all 0.3s ease;
    }
    
    .action-btn:hover .action-icon {
      transform: scale(1.15) rotate(-5deg);
    }
    
    /* Badges */
    .badge {
      border-radius: 8px;
      font-weight: 500;
    }
    
    /* Buttons */
    .btn {
      border-radius: 10px;
      font-weight: 600;
      transition: all 0.3s ease;
    }
    
    .btn-outline-secondary {
      border: 2px solid #6b7280;
      color: #6b7280;
    }
    
    .btn-outline-secondary:hover {
      background: #6b7280;
      border-color: #6b7280;
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(107, 114, 128, 0.2);
    }
    
    /* Progress Bars */
    .progress {
      border-radius: 10px;
      overflow: hidden;
      transition: all 0.3s ease;
    }
    
    .progress-bar {
      border-radius: 10px;
      transition: width 1s ease-in-out, transform 0.3s ease;
    }
    
    /* Empty State */
    .empty-state i {
      animation: float 3s ease-in-out infinite;
    }
    
    @keyframes float {
      0%, 100% {
        transform: translateY(0);
      }
      50% {
        transform: translateY(-10px);
      }
    }
    
    /* Card Hover Effects */
    .card:hover {
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08) !important;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .header-icon { font-size: 1.6rem; }
      .dashboard-header h1 { font-size: 1.6rem; }
      .avatar-circle { width: 80px; height: 80px; font-size: 2.8rem; }
      .action-icon { width: 42px; height: 42px; font-size: 1.2rem; }
    }

  //- JavaScript
  script.
    (function(){
      document.addEventListener('DOMContentLoaded', function(){
        // Fade-in animations for cards
        var cards = [
          document.querySelector('.profile-card'),
          document.querySelector('.account-status-card'),
          document.querySelector('.important-info-card'),
          document.querySelector('.quick-actions-card')
        ].filter(Boolean);
        
        cards.forEach(function(card, index){
          setTimeout(function(){
            card.classList.add('visible');
          }, index * 150);
        });

        // Animate progress bars
        setTimeout(function(){
          var progressBars = document.querySelectorAll('.progress-bar');
          progressBars.forEach(function(bar){
            var width = bar.style.width;
            bar.style.width = '0';
            setTimeout(function(){
              bar.style.width = width;
            }, 100);
          });
        }, 500);

        // Intersection Observer for scroll animations
        if ('IntersectionObserver' in window) {
          var observer = new IntersectionObserver(function(entries) {
            entries.forEach(function(entry) {
              if (entry.isIntersecting) {
                entry.target.classList.add('visible');
              }
            });
          }, { threshold: 0.1 });

          cards.forEach(function(card) { observer.observe(card); });
        }

        // Calculate profile completion
        function calculateProfileCompletion() {
          var fields = ['email', 'phone', 'address'];
          var completed = 0;
          
          fields.forEach(function(field) {
            var value = '#{user[field]}'.trim();
            if (value && value !== 'Belum diatur') {
              completed++;
            }
          });
          
          return Math.round((completed / fields.length) * 100);
        }

        // Update profile completion if needed
        var completionElement = document.querySelector('.progress-bar.bg-info');
        if (completionElement) {
          var computedCompletion = calculateProfileCompletion();
          completionElement.style.width = computedCompletion + '%';
          completionElement.parentElement.previousElementSibling.querySelector('.badge').textContent = computedCompletion + '%';
        }

        // Smooth scroll to top button
        var scrollBtn = document.createElement('button');
        scrollBtn.innerHTML = '<i class="bi bi-arrow-up"></i>';
        scrollBtn.className = 'btn btn-success position-fixed bottom-0 end-0 m-4 rounded-circle shadow-lg';
        scrollBtn.style.cssText = 'width: 50px; height: 50px; opacity: 0; transition: all 0.3s; z-index: 1000; display: none; border: none;';
        scrollBtn.onclick = function(){ window.scrollTo({ top: 0, behavior: 'smooth' }); };
        scrollBtn.onmouseover = function(){ this.style.transform = 'scale(1.1) translateY(-3px)'; };
        scrollBtn.onmouseout = function(){ this.style.transform = 'scale(1)'; };
        document.body.appendChild(scrollBtn);

        window.addEventListener('scroll', function(){
          if(window.scrollY > 400){
            scrollBtn.style.display = 'flex';
            scrollBtn.style.alignItems = 'center';
            scrollBtn.style.justifyContent = 'center';
            setTimeout(function(){ scrollBtn.style.opacity = '1'; }, 10);
          } else {
            scrollBtn.style.opacity = '0';
            setTimeout(function(){ scrollBtn.style.display = 'none'; }, 300);
          }
        });
      });
    })();