//- src/views/yayasan/dapur_orders.pug
extends ../layout

block content
  style.
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(-20px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    
    @keyframes shimmer {
      0% { background-position: -1000px 0; }
      100% { background-position: 1000px 0; }
    }

    /* Global Styles */
    body {
      background: #f8f9fa;
    }

    /* Header Section */
    .page-header {
      background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
      border-radius: 16px;
      padding: 32px;
      margin-bottom: 32px;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.04);
      border: 1px solid #e9ecef;
      animation: fadeInUp 0.5s ease-out;
    }
    
    .back-button {
      background: #ffffff;
      border: 2px solid #e9ecef;
      border-radius: 12px;
      padding: 10px 20px;
      color: #495057;
      font-weight: 600;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      text-decoration: none;
    }
    
    .back-button:hover {
      background: #f8f9fa;
      border-color: #28a745;
      color: #28a745;
      transform: translateX(-4px);
    }
    
    .dapur-info-box {
      background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
      border-radius: 16px;
      padding: 24px;
      color: white;
      margin-top: 20px;
      box-shadow: 0 8px 24px rgba(40, 167, 69, 0.2);
    }
    
    .dapur-avatar {
      width: 72px;
      height: 72px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      backdrop-filter: blur(10px);
    }
    
    .dapur-name {
      font-size: 1.75rem;
      font-weight: 800;
      margin: 0;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    .dapur-email {
      opacity: 0.95;
      font-size: 0.95rem;
      margin: 8px 0 0 0;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    /* Stats Cards */
    .stats-wrapper {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 32px;
      animation: fadeInUp 0.6s ease-out 0.1s both;
    }
    
    .stat-card {
      background: #ffffff;
      border-radius: 16px;
      padding: 24px;
      border: 1px solid #e9ecef;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, transparent, currentColor, transparent);
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .stat-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 28px rgba(0, 0, 0, 0.08);
      border-color: currentColor;
    }
    
    .stat-card:hover::before {
      opacity: 1;
    }
    
    .stat-card.primary {
      color: #4361ee;
    }
    
    .stat-card.success {
      color: #28a745;
    }
    
    .stat-card.info {
      color: #17a2b8;
    }
    
    .stat-icon-wrapper {
      width: 64px;
      height: 64px;
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      margin-bottom: 16px;
      transition: all 0.3s ease;
    }
    
    .stat-card.primary .stat-icon-wrapper {
      background: linear-gradient(135deg, rgba(67, 97, 238, 0.1), rgba(67, 97, 238, 0.2));
    }
    
    .stat-card.success .stat-icon-wrapper {
      background: linear-gradient(135deg, rgba(40, 167, 69, 0.1), rgba(40, 167, 69, 0.2));
    }
    
    .stat-card.info .stat-icon-wrapper {
      background: linear-gradient(135deg, rgba(23, 162, 184, 0.1), rgba(23, 162, 184, 0.2));
    }
    
    .stat-card:hover .stat-icon-wrapper {
      transform: rotate(-5deg) scale(1.05);
    }
    
    .stat-label {
      font-size: 0.85rem;
      color: #6c757d;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin: 0 0 8px 0;
    }
    
    .stat-value {
      font-size: 2rem;
      font-weight: 800;
      margin: 0;
      line-height: 1.2;
    }

    /* Order Card */
    .order-card {
      background: #ffffff;
      border-radius: 16px;
      border: 1px solid #e9ecef;
      margin-bottom: 24px;
      overflow: hidden;
      transition: all 0.3s ease;
      animation: fadeInUp 0.5s ease-out;
    }
    
    .order-card:hover {
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.08);
      border-color: #28a745;
      transform: translateY(-2px);
    }
    
    .order-header {
      background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
      padding: 24px;
      border-bottom: 1px solid #e9ecef;
    }
    
    .order-id-badge {
      background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
      color: white;
      padding: 10px 20px;
      border-radius: 12px;
      font-weight: 700;
      font-size: 0.95rem;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 4px 12px rgba(108, 117, 125, 0.2);
    }
    
    .order-total {
      font-size: 1.75rem;
      font-weight: 800;
      color: #28a745;
      margin: 8px 0 4px 0;
    }
    
    .order-date {
      color: #6c757d;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .status-badge-wrapper {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
    }
    
    .status-badge {
      padding: 10px 18px;
      border-radius: 12px;
      font-weight: 700;
      font-size: 0.85rem;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      border: 2px solid transparent;
      transition: all 0.3s ease;
    }
    
    .status-badge.pending {
      background: linear-gradient(135deg, #ffc107 0%, #ffb300 100%);
      color: #000;
      box-shadow: 0 4px 12px rgba(255, 193, 7, 0.3);
    }
    
    .status-badge.confirmed {
      background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
      color: white;
      box-shadow: 0 4px 12px rgba(23, 162, 184, 0.3);
    }
    
    .status-badge.completed {
      background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
      color: white;
      box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
    }
    
    .status-badge.cancelled {
      background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
      color: white;
      box-shadow: 0 4px 12px rgba(220, 53, 69, 0.3);
    }
    
    .status-badge:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
    }
    
    .delivery-complete-badge {
      background: linear-gradient(135deg, #e8f5eb 0%, #d4edda 100%);
      color: #28a745;
      padding: 8px 16px;
      border-radius: 12px;
      font-weight: 700;
      font-size: 0.8rem;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      border: 2px solid #c3e6cb;
      animation: pulse 2s infinite;
    }
    
    .vendor-status-badge {
      background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
      color: #1976d2;
      padding: 8px 16px;
      border-radius: 12px;
      font-weight: 700;
      font-size: 0.8rem;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      border: 2px solid #90caf9;
    }
    
    .detail-button {
      background: linear-gradient(135deg, #4361ee 0%, #3f37c9 100%);
      color: white;
      padding: 12px 24px;
      border-radius: 12px;
      font-weight: 700;
      font-size: 0.9rem;
      border: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      text-decoration: none;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(67, 97, 238, 0.3);
    }
    
    .detail-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(67, 97, 238, 0.4);
      color: white;
    }

    /* Items Table */
    .items-table-wrapper {
      padding: 24px;
    }
    
    .items-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
    }
    
    .items-table thead {
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    }
    
    .items-table thead th {
      padding: 16px;
      font-weight: 700;
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: #495057;
      border: none;
      position: relative;
    }
    
    .items-table thead th:first-child {
      border-top-left-radius: 12px;
    }
    
    .items-table thead th:last-child {
      border-top-right-radius: 12px;
    }
    
    .items-table tbody td {
      padding: 18px 16px;
      border-bottom: 1px solid #f0f0f0;
      vertical-align: middle;
    }
    
    .items-table tbody tr {
      transition: all 0.3s ease;
    }
    
    .items-table tbody tr:hover {
      background: linear-gradient(135deg, #f8fdf9 0%, #f0f9f3 100%);
    }
    
    .items-table tbody tr:last-child td {
      border-bottom: none;
    }
    
    .product-name {
      font-weight: 600;
      color: #2c3e50;
      font-size: 0.95rem;
    }
    
    .vendor-name {
      color: #6c757d;
      font-size: 0.85rem;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .vendor-name i {
      color: #28a745;
    }
    
    .qty-badge {
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      color: #495057;
      padding: 8px 16px;
      border-radius: 10px;
      font-weight: 700;
      font-size: 0.9rem;
      border: 2px solid #dee2e6;
      display: inline-block;
    }
    
    .price-text {
      font-weight: 700;
      color: #28a745;
      font-size: 1rem;
    }

    /* Empty State */
    .empty-state {
      background: #ffffff;
      border-radius: 16px;
      padding: 80px 40px;
      text-align: center;
      border: 2px dashed #e9ecef;
      animation: fadeInUp 0.5s ease-out;
    }
    
    .empty-icon {
      font-size: 80px;
      color: #e9ecef;
      margin-bottom: 24px;
      animation: pulse 3s ease-in-out infinite;
    }
    
    .empty-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: #495057;
      margin-bottom: 12px;
    }
    
    .empty-text {
      color: #6c757d;
      font-size: 1rem;
    }

    /* No Items Alert */
    .no-items-alert {
      background: linear-gradient(135deg, #fff9e6 0%, #fff3cd 100%);
      border: 2px solid #ffc107;
      border-radius: 12px;
      padding: 20px;
      margin: 24px;
      display: flex;
      align-items: center;
      gap: 12px;
      color: #856404;
    }
    
    .no-items-alert i {
      font-size: 24px;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .page-header {
        padding: 20px;
      }
      
      .dapur-info-box {
        padding: 20px;
      }
      
      .dapur-avatar {
        width: 56px;
        height: 56px;
        font-size: 24px;
      }
      
      .dapur-name {
        font-size: 1.35rem;
      }
      
      .stats-wrapper {
        grid-template-columns: 1fr;
        gap: 16px;
      }
      
      .stat-value {
        font-size: 1.5rem;
      }
      
      .order-header {
        padding: 20px;
      }
      
      .order-total {
        font-size: 1.4rem;
      }
      
      .status-badge-wrapper {
        margin-top: 16px;
      }
      
      .items-table-wrapper {
        padding: 16px;
        overflow-x: auto;
      }
      
      .items-table {
        min-width: 600px;
      }
      
      .items-table thead th,
      .items-table tbody td {
        padding: 12px;
        font-size: 0.85rem;
      }
    }

  .container-fluid.py-4
    //- Header Section
    .page-header
      .d-flex.align-items-center.mb-3
        a.back-button(href="/yayasan/dashboard")
          i.bi.bi-arrow-left
          span Kembali ke Dashboard
      
      .dapur-info-box
        .d-flex.align-items-center.gap-4
          .dapur-avatar
            i.bi.bi-person-fill
          div.flex-grow-1
            h1.dapur-name= dapur.name
            p.dapur-email
              i.bi.bi-envelope-fill
              = dapur.email

    //- Stats Summary
    if orders && orders.length
      .stats-wrapper
        .stat-card.primary
          .stat-icon-wrapper
            i.bi.bi-receipt
          p.stat-label Total Pesanan
          h2.stat-value= orders.length
        
        .stat-card.success
          .stat-icon-wrapper
            i.bi.bi-cash-stack
          p.stat-label Total Nilai
          h2.stat-value Rp #{orders.reduce((sum, o) => sum + Number(o.total || 0), 0).toLocaleString('id-ID')}
        
        .stat-card.info
          .stat-icon-wrapper
            i.bi.bi-box-seam
          p.stat-label Total Item
          h2.stat-value= orders.reduce((sum, o) => sum + (o.items ? o.items.length : 0), 0)

    //- Orders List
    if orders && orders.length
      each o in orders
        .order-card
          .order-header
            .row.align-items-center
              .col-lg-7.col-md-12.mb-3.mb-lg-0
                .d-flex.align-items-start.gap-3
                  .order-id-badge
                    i.bi.bi-hash
                    = o.id
                  div
                    .order-total Rp #{Number(o.total || 0).toLocaleString('id-ID')}
                    .order-date
                      i.bi.bi-calendar3
                      = o.created_at || o.created_at_raw || '-'
              
              .col-lg-5.col-md-12
                .status-badge-wrapper.justify-content-lg-end
                  -
                    let statusClass = 'secondary';
                    let statusIcon = 'circle';
                    let statusText = o.status || 'Unknown';
                    
                    if (o.status === 'pending') {
                      statusClass = 'pending';
                      statusIcon = 'clock-history';
                      statusText = 'Menunggu';
                    } else if (o.status === 'confirmed') {
                      statusClass = 'confirmed';
                      statusIcon = 'check-circle';
                      statusText = 'Dikonfirmasi';
                    } else if (o.status === 'completed') {
                      statusClass = 'completed';
                      statusIcon = 'check-circle-fill';
                      statusText = 'Selesai';
                    } else if (o.status === 'cancelled') {
                      statusClass = 'cancelled';
                      statusIcon = 'x-circle';
                      statusText = 'Dibatalkan';
                    }
                  
                  span.status-badge(class=statusClass)
                    i.bi(class=`bi-${statusIcon}`)
                    = statusText
                  
                  if o.allDeliveryNotesDone
                    span.delivery-complete-badge
                      i.bi.bi-file-earmark-check-fill
                      | Surat Jalan Lengkap
                  
                  if o.vendor_status
                    span.vendor-status-badge
                      i.bi.bi-truck
                      = o.vendor_status.toUpperCase()
                  
                  a.detail-button(href=`/yayasan/orders/${o.id}`)
                    i.bi.bi-eye
                    | Lihat Detail

          //- Order Items
          if o.items && o.items.length
            .items-table-wrapper
              table.items-table
                thead
                  tr
                    th
                      i.bi.bi-box.me-2
                      | Produk
                    th
                      i.bi.bi-shop.me-2
                      | Vendor
                    th.text-center
                      i.bi.bi-123.me-2
                      | Jumlah
                    th.text-end
                      i.bi.bi-currency-dollar.me-2
                      | Harga
                tbody
                  each it in o.items
                    tr
                      td
                        .product-name= it.product_name
                      td
                        if it.vendor_name
                          .vendor-name
                            i.bi.bi-shop
                            = it.vendor_name
                        else
                          .vendor-name
                            i.bi.bi-shop
                            span.fst-italic Vendor #{it.vendor_id || 'N/A'}
                      td.text-center
                        - var qtyInt = parseInt(it.qty, 10) || 0
                        span.qty-badge= qtyInt
                      td.text-end
                        span.price-text Rp #{Number(it.price).toLocaleString('id-ID')}
          else
            .no-items-alert
              i.bi.bi-info-circle-fill
              span Tidak ada item dalam pesanan ini
    else
      .empty-state
        .empty-icon
          i.bi.bi-inbox
        h3.empty-title Belum Ada Pesanan
        p.empty-text Dapur ini belum memiliki riwayat pesanan apapun