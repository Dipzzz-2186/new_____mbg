// ================== NAVBAR ==================
nav.navbar.navbar-light.sticky-top(
  style="background: rgba(255, 255, 255, 0.98); backdrop-filter: blur(12px); box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);"
)
  .container-fluid.px-3.px-lg-5.py-2

    // LEFT — BRAND
    a.navbar-brand.d-flex.align-items-center.fw-bold(
      href="/market"
      style="color:#1f2937;"
    )
      i.bi.bi-bag-check(
        style="font-size:1.8rem;color:#10b981;margin-right:0.6rem;"
      )
      span(style="font-size:1.4rem;letter-spacing:-0.5px;") FreshMart

    // RIGHT (MOBILE) — ICONS ONLY
    .d-flex.align-items-center.gap-3.d-lg-none

      // CART ICON
      .dropdown
        a.nav-icon-link.position-relative(
          href="#"
          role="button"
          data-bs-toggle="dropdown"
          aria-expanded="false"
        )
          i.bi.bi-cart3(style="font-size:1.5rem;")
          if cartCount && cartCount > 0
            span.cart-badge= cartCount

        // CART DROPDOWN
        .dropdown-menu.dropdown-menu-end.shadow-lg.border-0.cart-dropdown-menu
          if miniCartItems && miniCartItems.length
            .cart-dropdown-header.d-flex.justify-content-between.align-items-center.mb-2
              h6.mb-0 Keranjang
              span.badge.bg-light.text-muted #{Number(cartCount || 0)} item

            each item in miniCartItems
              .d-flex.align-items-center.mb-3
                if item.image_url
                  img.me-3.rounded(
                    src=item.image_url
                    alt=item.name
                    style="width:44px;height:44px;object-fit:cover;"
                  )
                else
                  .me-3.rounded-circle.d-flex.align-items-center.justify-content-center(
                    style="width:44px;height:44px;background:#f3f4f6;"
                  )
                    i.bi.bi-box-seam.text-muted

                .flex-grow-1
                  .fw-semibold(style="font-size:0.9rem;")= item.name
                  .text-muted.small Qty: #{Number(item.qty || 0)}
                .text-end.ms-2
                  .fw-semibold(style="font-size:0.9rem;")
                    | Rp #{item.subtotalFormatted}

            hr.my-2
            .d-flex.justify-content-between.align-items-center.mb-3
              span.text-muted Total
              strong Rp #{miniCartTotalFormatted}

            a.btn.btn-success.w-100(href="/dapur/cart") Lihat Keranjang
          else
            .text-center.py-3.cart-empty-state
              i.bi.bi-bag-x-fill.mb-3(style="font-size:2.8rem;color:#10b981;")
              h6.mb-1 Wah, keranjang kosong
              p.text-muted.small Yuk mulai belanja!
              a.btn.btn-outline-success.btn-sm(href="/market") Mulai Belanja

      // USER ICON
      .dropdown
        a.nav-icon-link(
          href="#"
          role="button"
          data-bs-toggle="dropdown"
          aria-expanded="false"
        )
          i.bi.bi-person-circle(style="font-size:1.6rem;")

        ul.dropdown-menu.dropdown-menu-end.shadow-lg.border-0.mt-3(
          style="border-radius:16px;min-width:240px;padding:0.5rem;"
        )
          if currentUser
            li
              .dropdown-header.px-3.py-3(style="background:#f9fafb;border-radius:12px;")
                .d-flex.align-items-center.mb-1
                  i.bi.bi-person-circle.me-2(style="font-size:2rem;color:#10b981;")
                  .flex-grow-1
                    .fw-semibold= currentUser.name || 'User'
                    .small.text-muted
                      i.bi.bi-shield-check.me-1
                      = currentUser.role

            li
              hr.dropdown-divider

            li
              a.dropdown-item.menu-item(
                href=(currentUser.role === 'dapur'
                      ? "/dapur/dashboard"
                      : currentUser.role === 'vendor'
                      ? "/vendor/dashboard"
                      : "/yayasan/dashboard")
              )
                i.bi.bi-speedometer2.me-3
                span Dashboard

            if currentUser.role === 'dapur'
              li
                a.dropdown-item.menu-item(href="/dapur/profile")
                  i.bi.bi-gear.me-3
                  span Pengaturan

            li
              hr.dropdown-divider

            li
              form(action="/logout" method="POST")
                button.dropdown-item.menu-item.logout-btn(type="submit")
                  i.bi.bi-box-arrow-right.me-3
                  span Keluar
          else
            li
              a.dropdown-item.menu-item(href="/login")
                i.bi.bi-box-arrow-in-right.me-3
                span Masuk

    // DESKTOP NAV + SEARCH (VISIBLE LG+)
    .d-none.d-lg-flex.flex-grow-1.justify-content-center

      form.d-flex.w-100(
        method="GET"
        action="/market"
        style="max-width:550px;"
      )
        .search-container.position-relative.w-100
          i.bi.bi-search(
            style="position:absolute;left:1rem;top:50%;transform:translateY(-50%);color:#9ca3af;"
          )
          input#navSearch.form-control(
            type="search"
            name="q"
            placeholder="Cari produk..."
            value=(typeof searchQuery !== 'undefined' ? searchQuery : '')
            style="border-radius:50px;padding:0.75rem 1.2rem 0.75rem 2.8rem;border:2px solid #e5e7eb;"
          )

    // DESKTOP RIGHT ICONS
    .d-none.d-lg-flex.align-items-center.gap-3.ms-4

      // CART
      .dropdown
        a.nav-icon-link.position-relative(
          href="#"
          data-bs-toggle="dropdown"
        )
          i.bi.bi-cart3(style="font-size:1.5rem;")
          if cartCount && cartCount > 0
            span.cart-badge= cartCount
        .dropdown-menu.dropdown-menu-end.shadow-lg.border-0.cart-dropdown-menu
          if miniCartItems && miniCartItems.length
            .cart-dropdown-header.d-flex.justify-content-between.align-items-center.mb-2
              h6.mb-0 Keranjang
              span.badge.bg-light.text-muted #{Number(cartCount || 0)} item

            each item in miniCartItems
              .d-flex.align-items-center.mb-3
                if item.image_url
                  img.me-3.rounded(
                    src=item.image_url
                    alt=item.name
                    style="width:44px;height:44px;object-fit:cover;"
                  )
                else
                  .me-3.rounded-circle.d-flex.align-items-center.justify-content-center(
                    style="width:44px;height:44px;background:#f3f4f6;"
                  )
                    i.bi.bi-box-seam.text-muted

                .flex-grow-1
                  .fw-semibold(style="font-size:0.9rem;")= item.name
                  .text-muted.small Qty: #{Number(item.qty || 0)}
                .text-end.ms-2
                  .fw-semibold(style="font-size:0.9rem;")
                    | Rp #{item.subtotalFormatted}

            hr.my-2
            .d-flex.justify-content-between.align-items-center.mb-3
              span.text-muted Total
              strong Rp #{miniCartTotalFormatted}

            a.btn.btn-success.w-100(href="/dapur/cart") Lihat Keranjang
          else
            .text-center.py-3.cart-empty-state
              i.bi.bi-bag-x-fill.mb-3(style="font-size:2.8rem;color:#10b981;")
              h6.mb-1 Wah, keranjang kosong
              p.text-muted.small Yuk mulai belanja!
              a.btn.btn-outline-success.btn-sm(href="/market") Mulai Belanja

      // USER
      .dropdown
        a.nav-icon-link(href="#" data-bs-toggle="dropdown")
          i.bi.bi-person-circle(style="font-size:1.6rem;")
        ul.dropdown-menu.dropdown-menu-end.shadow-lg.border-0.mt-3(
          style="border-radius:16px;min-width:240px;padding:0.5rem;"
        )
          if currentUser
            li
              .dropdown-header.px-3.py-3(style="background:#f9fafb;border-radius:12px;")
                .d-flex.align-items-center.mb-1
                  i.bi.bi-person-circle.me-2(style="font-size:2rem;color:#10b981;")
                  .flex-grow-1
                    .fw-semibold= currentUser.name || 'User'
                    .small.text-muted
                      i.bi.bi-shield-check.me-1
                      = currentUser.role

            li
              hr.dropdown-divider

            li
              a.dropdown-item.menu-item(
                href=(currentUser.role === 'dapur'
                      ? "/dapur/dashboard"
                      : currentUser.role === 'vendor'
                      ? "/vendor/dashboard"
                      : "/yayasan/dashboard")
              )
                i.bi.bi-speedometer2.me-3
                span Dashboard

            if currentUser.role === 'dapur'
              li
                a.dropdown-item.menu-item(href="/dapur/profile")
                  i.bi.bi-gear.me-3
                  span Pengaturan

            li
              hr.dropdown-divider

            li
              form(action="/logout" method="POST")
                button.dropdown-item.menu-item.logout-btn(type="submit")
                  i.bi.bi-box-arrow-right.me-3
                  span Keluar
          else
            li
              a.dropdown-item.menu-item(href="/login")
                i.bi.bi-box-arrow-in-right.me-3
                span Masuk

/// ===== MOBILE SEARCH BAR (TAMPIL DI BAWAH NAVBAR) =====
.div.mobile-search-wrapper.d-lg-none(style="padding:0.5rem 1rem;")
  form(method="GET" action="/market")
    .search-container.position-relative.w-100
      i.bi.bi-search(
        style="position:absolute;left:1rem;top:50%;transform:translateY(-50%);color:#9ca3af;"
      )
      input.form-control(
        type="search"
        name="q"
        placeholder="Cari produk..."
        value=(typeof searchQuery !== 'undefined' ? searchQuery : '')
        style="border-radius:50px;padding:0.7rem 1.2rem 0.7rem 2.8rem;border:2px solid #e5e7eb;"
      )


// Enhanced CSS Styling
style.
 /* ===== CART DROPDOWN (MINI CART) ===== */
  .cart-dropdown-menu {
    width: 340px;
    padding: 0.9rem 1rem 1rem;
    border-radius: 18px;
  }

  .cart-dropdown-menu .cart-dropdown-header h6 {
    font-size: 0.95rem;
  }

  .cart-empty-state h6 {
    font-size: 0.95rem;
  }

  .cart-empty-state p {
    line-height: 1.4;
  }

  @media (max-width: 576px) {
    .cart-dropdown-menu {
      width: 100vw;
      max-width: 360px;
      margin-right: 0.5rem;
    }
  }
  /* ===== NAVBAR STYLING ===== */
  .navbar {
    transition: all 0.3s ease;
    border-bottom: 1px solid rgba(229, 231, 235, 0.8);
  }
  
  .navbar.scrolled {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    padding: 0.5rem 0 !important;
  }
  
  /* ===== BRAND HOVER ===== */
  .navbar-brand:hover {
    transform: translateX(3px);
  }
  
  .navbar-brand:hover i {
    transform: rotate(12deg) scale(1.1);
    color: #059669;
  }
  
  /* ===== SEARCH BAR ===== */
  .search-container {
    position: relative;
  }
  
  #navSearch:focus {
    border-color: #10b981;
    box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.1);
    outline: none;
  }
  
  #navSearch:focus + .search-icon {
    color: #10b981;
  }
  
  #navSearch::placeholder {
    color: #9ca3af;
  }
  
  /* ===== NAV ICONS ===== */
  .nav-icon-link {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 44px;
    height: 44px;
    border-radius: 50%;
    color: #4b5563;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    text-decoration: none;
  }
  
  .nav-icon-link:hover {
    background: #f3f4f6;
    color: #10b981;
    transform: translateY(-2px);
  }
  
  .nav-icon-link:active {
    transform: translateY(0);
  }
  
  /* ===== CART BADGE ===== */
  .cart-badge {
    position: absolute;
    top: 2px;
    right: 2px;
    background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
    color: white;
    font-size: 0.7rem;
    font-weight: 700;
    padding: 2px 6px;
    border-radius: 10px;
    min-width: 18px;
    height: 18px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 4px rgba(239, 68, 68, 0.4);
    animation: cartBadgePulse 2s ease-in-out infinite;
  }
  
  @keyframes cartBadgePulse {
    0%, 100% {
      transform: scale(1);
    }
    50% {
      transform: scale(1.1);
    }
  }
  
  /* ===== DROPDOWN MENU ===== */
  .dropdown-menu {
    animation: dropdownSlide 0.3s ease-out;
    border: 1px solid #e5e7eb;
  }
  
  @keyframes dropdownSlide {
    from {
      opacity: 0;
      transform: translateY(-12px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  .dropdown-header {
    border: none;
    padding: 0;
  }
  
  .user-avatar {
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  /* ===== DROPDOWN ITEMS ===== */
  .menu-item {
    display: flex;
    align-items: center;
    padding: 0.7rem 1rem;
    margin: 0.2rem 0.25rem;
    border-radius: 10px;
    color: #4b5563;
    font-weight: 500;
    transition: all 0.2s ease;
    border: none;
    background: transparent;
    text-decoration: none;
    width: calc(100% - 0.5rem);
    cursor: pointer;
  }
  
  .menu-item i {
    font-size: 1.1rem;
    width: 20px;
    transition: transform 0.2s ease;
  }
  
  .menu-item:hover {
    background: #f0fdf4;
    color: #10b981;
    transform: translateX(4px);
  }
  
  .menu-item:hover i {
    transform: scale(1.15);
  }
  
  .logout-btn:hover {
    background: #fef2f2;
    color: #ef4444;
  }
  
  .logout-btn:hover i {
    transform: translateX(3px);
  }
  
  /* ===== MOBILE RESPONSIVE ===== */
  @media (max-width: 991px) {
    .navbar-collapse {
      background: white;
      padding: 1.5rem;
      border-radius: 16px;
      margin-top: 1rem;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
      animation: mobileMenuSlide 0.3s ease-out;
    }
    
    @keyframes mobileMenuSlide {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    #navSearch {
      width: 100%;
    }
    
    .nav-icon-link {
      width: 48px;
      height: 48px;
    }
    
    .dropdown-menu {
      width: 100%;
      max-width: 100%;
    }
  }
  
  /* ===== TOGGLER ANIMATION ===== */
  .navbar-toggler:focus {
    box-shadow: none;
  }
  
  .navbar-toggler i {
    transition: transform 0.3s ease;
  }
  
  .navbar-toggler:hover i {
    transform: scale(1.1);
    color: #10b981;
  }
  
  /* ===== SCROLL BEHAVIOR ===== */
  @media (min-width: 992px) {
    .navbar-brand {
      font-size: 1.3rem;
    }
  }
  
  /* ===== DIVIDER STYLING ===== */
  .dropdown-divider {
    border-top: 1px solid #e5e7eb;
    opacity: 0.6;
  }
  
  /* ===== FOCUS STATES ===== */
  .dropdown-item:focus,
  .menu-item:focus {
    background: #f0fdf4;
    color: #10b981;
    outline: none;
  }
  
  /* ===== SMOOTH TRANSITIONS ===== */
  * {
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

script.
  // Navbar scroll effect
  let lastScroll = 0;
  window.addEventListener('scroll', function() {
    const navbar = document.querySelector('.navbar');
    const currentScroll = window.pageYOffset;
    
    if (currentScroll > 50) {
      navbar.classList.add('scrolled');
    } else {
      navbar.classList.remove('scrolled');
    }
    
    lastScroll = currentScroll;
  });
  
  // Search input animation
  const searchInput = document.getElementById('navSearch');
  if (searchInput) {
    searchInput.addEventListener('focus', function() {
      this.parentElement.style.transform = 'scale(1.02)';
    });
    
    searchInput.addEventListener('blur', function() {
      this.parentElement.style.transform = 'scale(1)';
    });
  }
  
  // Close dropdown on click outside
  document.addEventListener('click', function(e) {
    const dropdowns = document.querySelectorAll('.dropdown-menu.show');
    dropdowns.forEach(dropdown => {
      if (!dropdown.parentElement.contains(e.target)) {
        const bsDropdown = bootstrap.Dropdown.getInstance(dropdown.previousElementSibling);
        if (bsDropdown) bsDropdown.hide();
      }
    });
  });